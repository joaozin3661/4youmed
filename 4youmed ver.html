<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>4youMed - Plataforma de Questões</title>
    
    <!-- Tailwind CSS para estilização rápida -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Ícones (Heroicons) -->
    <script type="module" src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.esm.js"></script>
    <script nomodule src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.js"></script>

    <style>
        /* Estilo customizado para usar a fonte Inter e cores base */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f2f5; /* Fundo cinza claro */
        }
        /* Estilo para a barra de rolagem da anotação */
        .anotacoes-sidebar::-webkit-scrollbar { width: 8px; }
        .anotacoes-sidebar::-webkit-scrollbar-track { background: #374151; } /* gray-700 */
        .anotacoes-sidebar::-webkit-scrollbar-thumb { background: #9ca3af; border-radius: 4px; } /* gray-400 */
        .anotacoes-sidebar::-webkit-scrollbar-thumb:hover { background: #d1d5db; } /* gray-300 */
        
        /* Classe para o link de navegação ativo */
        .sub-nav-link-active {
            border-bottom-color: #2563eb; /* blue-600 */
            color: #1e40af; /* blue-800 */
        }
        
        /* Estilos para o Flash Card Stack */
        .card-stack-container {
            position: relative;
            width: 100%;
            max-width: 320px;
            height: 200px;
            margin: 2rem auto;
        }
        .card-container {
            position: absolute;
            width: 100%;
            height: 100%;
            perspective: 1000px;
            transition: transform 0.3s ease, opacity 0.3s ease;
        }
        .card {
            width: 100%;
            height: 100%;
            position: relative;
            transition: transform 0.6s;
            transform-style: preserve-3d;
            cursor: pointer;
        }
        .card.is-flipped {
            transform: rotateY(180deg);
        }
        .card.is-dismissed {
             transform: translateX(500px) rotate(30deg);
             opacity: 0;
        }
        .card-face {
            position: absolute;
            width: 100%;
            height: 100%;
            -webkit-backface-visibility: hidden;
            backface-visibility: hidden;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 1rem;
            border-radius: 0.75rem;
            box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1), 0 4px 6px -2px rgba(0,0,0,0.05);
            border: 1px solid #e5e7eb;
        }
        .card-front {
            background-color: white;
            color: #1f2937;
            text-align: center;
        }
        .card-back {
            background-color: #4b5563; /* gray-600 */
            color: white;
            transform: rotateY(180deg);
            overflow-y: auto;
            justify-content: flex-start;
            align-items: flex-start;
        }
    </style>
</head>
<body class="bg-gray-100">

    <!-- Estrutura principal da aplicação -->
    <div id="app" class="flex flex-col min-h-screen">

        <!-- Cabeçalho Principal -->
        <header class="bg-white shadow-md sticky top-0 z-20">
            <nav class="container mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex items-center justify-between h-16">
                    <div class="flex-shrink-0">
                        <h1 class="text-2xl font-bold text-blue-600">4youMed</h1>
                    </div>
                    <div id="main-nav" class="hidden md:block">
                        <div class="ml-10 flex items-baseline space-x-4">
                            <a href="#basico" class="nav-link bg-blue-600 text-white px-3 py-2 rounded-md text-sm font-medium">Ciclo Básico</a>
                            <a href="#clinico" class="nav-link text-gray-500 hover:bg-gray-200 hover:text-gray-800 px-3 py-2 rounded-md text-sm font-medium">Ciclo Clínico</a>
                        </div>
                    </div>
                    <div class="hidden md:block">
                         <button id="toggleAnotacoes" class="bg-gray-800 p-2 rounded-md text-gray-400 hover:text-white hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-800 focus:ring-white">
                            <span class="sr-only">Abrir anotações</span>
                            <svg class="h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path></svg>
                        </button>
                    </div>
                    <div class="-mr-2 flex md:hidden">
                        <button id="mobile-menu-button" type="button" class="bg-gray-800 inline-flex items-center justify-center p-2 rounded-md text-gray-400 hover:text-white hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-800 focus:ring-white" aria-controls="mobile-menu" aria-expanded="false">
                            <span class="sr-only">Abrir menu principal</span>
                            <svg class="block h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" /></svg>
                            <svg class="hidden h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
                        </button>
                    </div>
                </div>
            </nav>
            <div class="md:hidden hidden" id="mobile-menu">
                <div id="main-nav-mobile" class="px-2 pt-2 pb-3 space-y-1 sm:px-3">
                    <a href="#basico" class="nav-link-mobile bg-blue-600 text-white block px-3 py-2 rounded-md text-base font-medium">Ciclo Básico</a>
                    <a href="#clinico" class="nav-link-mobile text-gray-500 hover:bg-gray-200 hover:text-gray-800 block px-3 py-2 rounded-md text-base font-medium">Ciclo Clínico</a>
                    <a href="#" id="toggleAnotacoesMobile" class="text-gray-500 hover:bg-gray-200 hover:text-gray-800 block px-3 py-2 rounded-md text-base font-medium">Anotações</a>
                </div>
            </div>
        </header>

        <!-- Sub-Navegação -->
        <div class="bg-white border-b border-gray-200">
            <div id="sub-nav" class="container mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex items-center space-x-4 h-12">
                     <a href="#exercicios-page" class="sub-nav-link border-b-2 sub-nav-link-active px-3 py-2 text-sm font-semibold cursor-pointer">Exercícios</a>
                     <a href="#simulados-page" class="sub-nav-link border-b-2 border-transparent text-gray-500 hover:text-gray-800 hover:border-gray-300 px-3 py-2 text-sm font-semibold cursor-pointer">Simulados</a>
                     <a href="#meus-cards-page" class="sub-nav-link border-b-2 border-transparent text-gray-500 hover:text-gray-800 hover:border-gray-300 px-3 py-2 text-sm font-semibold cursor-pointer">Meus Cards</a>
                </div>
            </div>
        </div>

        <!-- Conteúdo Principal -->
        <main class="container mx-auto p-4 sm:p-6 lg:p-8 flex-grow">
            <!-- PÁGINA DE EXERCÍCIOS -->
            <div id="exercicios-page" class="main-page">
                <div id="basico-exercicios" class="page-section bg-white p-6 rounded-lg shadow-lg">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6">Exercícios - Ciclo Básico</h2>
                    <div class="space-y-6">
                         <div>
                            <label for="disciplinas-basico-exercicios" class="block text-sm font-medium text-gray-700">1. Selecione a(s) Disciplina(s):</label>
                            <select id="disciplinas-basico-exercicios" multiple class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md h-24">
                                <option value="Anatomia">Anatomia</option>
                            </select>
                        </div>
                        <div id="temas-container-basico-exercicios" class="space-y-4"></div>
                        <div>
                            <label for="num-questoes-basico-exercicios" class="block text-sm font-medium text-gray-700">3. Número de Questões por Tema:</label>
                            <input type="number" id="num-questoes-basico-exercicios" class="num-questoes-input mt-1 focus:ring-blue-500 focus:border-blue-500 block w-full sm:w-48 shadow-sm sm:text-sm border-gray-300 rounded-md" value="5" min="1" max="100">
                        </div>
                        <div>
                            <button type="button" class="criar-caderno-btn inline-flex items-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                                Criar Caderno de Exercícios
                            </button>
                        </div>
                    </div>
                </div>
                <div id="clinico-exercicios" class="page-section bg-white p-6 rounded-lg shadow-lg hidden">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6">Exercícios - Ciclo Clínico</h2>
                     <div class="space-y-6">
                        <div>
                            <label for="disciplinas-clinico-exercicios" class="block text-sm font-medium text-gray-700">1. Selecione a(s) Disciplina(s):</label>
                            <select id="disciplinas-clinico-exercicios" multiple class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md h-40">
                                <option value="Cardiologia">Cardiologia</option><option value="Cirurgia">Cirurgia</option><option value="Doenças Infecto Parasitárias">Doenças Infecto Parasitárias</option><option value="Endocrinologia">Endocrinologia</option><option value="Farmacologia">Farmacologia</option><option value="Ginecologia e Obstetrícia">Ginecologia e Obstetrícia</option><option value="Hematologia">Hematologia</option><option value="Nefrologia">Nefrologia</option><option value="Dermatologia">Dermatologia</option><option value="Neurologia">Neurologia</option><option value="Oncologia">Oncologia</option><option value="Ortopedia">Ortopedia</option><option value="Pediatria">Pediatria</option><option value="Psiquiatria">Psiquiatria</option><option value="Saúde Coletiva">Saúde Coletiva</option><option value="Urgência e Emergência">Urgência e Emergência</option><option value="Urologia">Urologia</option>
                            </select>
                        </div>
                        <div id="temas-container-clinico-exercicios" class="space-y-4"></div>
                        <div>
                            <label for="num-questoes-clinico-exercicios" class="block text-sm font-medium text-gray-700">3. Número de Questões por Tema:</label>
                            <input type="number" id="num-questoes-clinico-exercicios" class="num-questoes-input mt-1 focus:ring-blue-500 focus:border-blue-500 block w-full sm:w-48 shadow-sm sm:text-sm border-gray-300 rounded-md" value="5" min="1" max="100">
                        </div>
                        <div>
                            <button type="button" class="criar-caderno-btn inline-flex items-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                                Criar Caderno de Exercícios
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            <!-- PÁGINA DE SIMULADOS -->
            <div id="simulados-page" class="main-page hidden">
                <div id="basico-simulados" class="page-section bg-white p-6 rounded-lg shadow-lg">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6">Simulados - Ciclo Básico</h2>
                    <div class="space-y-6">
                        <div>
                            <label for="disciplinas-basico-simulados" class="block text-sm font-medium text-gray-700">1. Selecione a(s) Disciplina(s):</label>
                            <select id="disciplinas-basico-simulados" multiple class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md h-24">
                                <option value="Anatomia">Anatomia</option>
                            </select>
                        </div>
                        <div id="temas-container-basico-simulados" class="space-y-4"></div>
                        <div>
                            <label for="num-questoes-basico-simulados" class="block text-sm font-medium text-gray-700">3. Número de Questões por Tema:</label>
                            <input type="number" id="num-questoes-basico-simulados" class="num-questoes-input mt-1 focus:ring-blue-500 focus:border-blue-500 block w-full sm:w-48 shadow-sm sm:text-sm border-gray-300 rounded-md" value="5" min="1" max="100">
                        </div>
                        <div>
                            <button type="button" class="criar-caderno-btn inline-flex items-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                                Criar Simulado
                            </button>
                        </div>
                    </div>
                </div>
                <div id="clinico-simulados" class="page-section bg-white p-6 rounded-lg shadow-lg hidden">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6">Simulados - Ciclo Clínico</h2>
                     <div class="space-y-6">
                        <div>
                            <label for="disciplinas-clinico-simulados" class="block text-sm font-medium text-gray-700">1. Selecione a(s) Disciplina(s):</label>
                            <select id="disciplinas-clinico-simulados" multiple class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md h-40">
                                <option value="Cardiologia">Cardiologia</option><option value="Cirurgia">Cirurgia</option><option value="Doenças Infecto Parasitárias">Doenças Infecto Parasitárias</option><option value="Endocrinologia">Endocrinologia</option><option value="Farmacologia">Farmacologia</option><option value="Ginecologia e Obstetrícia">Ginecologia e Obstetrícia</option><option value="Hematologia">Hematologia</option><option value="Nefrologia">Nefrologia</option><option value="Neurologia">Neurologia</option><option value="Ortopedia">Ortopedia</option><option value="Pediatria">Pediatria</option><option value="Psiquiatria">Psiquiatria</option><option value="Saúde Coletiva">Saúde Coletiva</option><option value="Urgência e Emergência">Urgência e Emergência</option><option value="Urologia">Urologia</option>
                            </select>
                        </div>
                        <div id="temas-container-clinico-simulados" class="space-y-4"></div>
                        <div>
                            <label for="num-questoes-clinico-simulados" class="block text-sm font-medium text-gray-700">3. Número de Questões por Tema:</label>
                            <input type="number" id="num-questoes-clinico-simulados" class="num-questoes-input mt-1 focus:ring-blue-500 focus:border-blue-500 block w-full sm:w-48 shadow-sm sm:text-sm border-gray-300 rounded-md" value="5" min="1" max="100">
                        </div>
                        <div>
                            <button type="button" class="criar-caderno-btn inline-flex items-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                                Criar Simulado
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- PÁGINA MEUS CARDS -->
            <div id="meus-cards-page" class="main-page hidden">
                <div class="bg-white p-6 rounded-lg shadow-lg">
                    <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between mb-6">
                        <h2 class="text-2xl font-bold text-gray-800">Meus Cards de Anotações</h2>
                        <div class="mt-4 sm:mt-0">
                            <label for="cards-filter-disciplina" class="block text-sm font-medium text-gray-700 sr-only">Filtrar por Disciplina:</label>
                            <select id="cards-filter-disciplina" class="mt-1 block w-full sm:w-64 pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md">
                                <option value="todas">Todas as Disciplinas</option>
                                <!-- Opções populadas dinamicamente -->
                            </select>
                        </div>
                    </div>
                    <div id="card-stacks-container" class="flex flex-col items-center">
                        <!-- Pilhas de Flash cards serão inseridas aqui -->
                    </div>
                </div>
            </div>
            
            <!-- PÁGINA DO CADERNO DE QUESTÕES -->
            <div id="caderno-page" class="main-page hidden">
                <div class="bg-white p-6 rounded-lg shadow-lg">
                    <div class="flex items-center justify-between mb-8">
                        <h2 id="caderno-title" class="text-2xl font-bold text-gray-800">Seu Caderno de Questões</h2>
                        <button id="voltar-btn" class="text-blue-600 hover:underline font-semibold">← Voltar aos filtros</button>
                    </div>
                    <div id="questoes-container" class="space-y-10">
                        <!-- As questões serão inseridas aqui -->
                    </div>
                </div>
            </div>

        </main>

        <!-- Rodapé -->
        <footer class="bg-white mt-8 border-t border-gray-200">
            <div class="container mx-auto py-4 px-4 sm:px-6 lg:px-8 text-center text-gray-500 text-sm">
                &copy; 2025 4youMed. Todos os direitos reservados.
            </div>
        </footer>
    </div>

    <!-- Sidebar de Anotações -->
    <div id="anotacoes-sidebar" class="anotacoes-sidebar fixed top-0 right-0 h-full w-full sm:w-96 bg-gray-800 text-white shadow-xl transform translate-x-full transition-transform duration-300 ease-in-out z-30 flex flex-col">
        <div class="p-6">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-xl font-bold">Anotações</h3>
                <button id="closeAnotacoes" class="p-1 rounded-full text-gray-300 hover:bg-gray-700 focus:outline-none">
                     <svg class="h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
                </button>
            </div>
            <div class="space-y-4">
                <div>
                    <label for="anotacao-disciplina" class="block text-sm font-medium text-gray-300">Disciplina:</label>
                    <select id="anotacao-disciplina" name="anotacao-disciplina" class="mt-1 block w-full pl-3 pr-10 py-2 text-base bg-gray-700 border-gray-600 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md">
                        <option value="">Selecione uma disciplina</option>
                        <!-- Opções populadas dinamicamente -->
                    </select>
                </div>
                <div>
                    <label for="anotacao-nome" class="block text-sm font-medium text-gray-300">Nome da Anotação:</label>
                    <input type="text" name="anotacao-nome" id="anotacao-nome" placeholder="Ex: Resumo Aula X" class="mt-1 block w-full text-base bg-gray-700 border-gray-600 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md">
                </div>
                 <div>
                    <label for="anotacao-texto" class="block text-sm font-medium text-gray-300">Sua Anotação:</label>
                    <textarea id="anotacao-texto" name="anotacao-texto" rows="6" placeholder="Digite suas notas aqui..." class="mt-1 block w-full text-base bg-gray-700 border-gray-600 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md"></textarea>
                </div>
                <div>
                     <button type="button" id="salvar-anotacao-btn" class="w-full inline-flex justify-center items-center px-4 py-2 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-800 focus:ring-blue-500">
                        Salvar Anotação
                    </button>
                </div>
            </div>
        </div>
        <div class="flex-grow p-6 border-t border-gray-700 overflow-y-auto">
            <h4 class="text-lg font-semibold mb-4 text-gray-300">Minhas Anotações Salvas</h4>
            <div id="saved-notes-list" class="space-y-3">
                <!-- Lista de anotações salvas será inserida aqui -->
            </div>
        </div>
    </div>
    <div id="sidebar-overlay" class="fixed inset-0 bg-black bg-opacity-50 z-20 hidden"></div>

    
   <script>
        document.addEventListener('DOMContentLoaded', () => {

            // --- DADOS E LISTAS DO SITE ---
            const temasPorDisciplina = {
                'Anatomia': ['Sistema Esquelético', 'Sistema Muscular', 'Sistema Nervoso Central', 'Sistema Nervoso Periférico', 'Anatomia do Coração', 'Anatomia do Sistema Respiratório', 'Anatomia do Trato Gastrointestinal','Anatomia do Sistema Urinário'],
                'Cardiologia': ['Hipertensão Arterial Sistêmica', 'Insuficiência Cardíaca', 'Doença Arterial Coronariana', 'Arritmias Cardíacas', 'Valvopatias', 'Eletrocardiograma (ECG)'],
                'Endocrinologia': ['Diabetes Mellitus Tipo 1', 'Diabetes Mellitus Tipo 2', 'Doenças da Tireoide', 'Doenças da Adrenal', 'Distúrbios do Metabolismo do Cálcio', 'Obesidade e Síndrome Metabólica'],
                'Pediatria': ['Doenças Exantemáticas', 'Puericultura e Crescimento', 'Aleitamento Materno', 'Imunizações', 'Neonatologia', 'Asma na Infância', 'Gastroenterites'],
                'Cirurgia': ['Abdome Agudo Inflamatório', 'Abdome Agudo Obstrutivo', 'Trauma (ATLS)', 'Hérnias da Parede Abdominal', 'Cicatrização', 'Infecção em Sítio Cirúrgico'],
                'Ginecologia e Obstetrícia': ['Ciclo Menstrual e Fisiologia', 'Anticoncepção', 'Doenças Sexualmente Transmissíveis (DSTs)', 'Assistência Pré-natal', 'Mecanismo do Parto', 'Hemorragias na Gestação'],
                'Hematologia': ['Anemias Carenciais', 'Anemias Hemolíticas', 'Leucemias Agudas', 'Distúrbios da Coagulação'],
                'Nefrologia': ['Introdução a Nefrologia','Distúrbios Hidroeletrolíticos', 'Doenças Renais','Doenças glomerulares', 'Glomerulonefrites','Lesão Renal Aguda'],
                'Neurologia': ['Acidente Vascular Cerebral (AVC)','Exames Complementares em Neurologia', 'Cefaleias', 'Epilepsia', 'Doenças Neurodegenerativas (Parkinson, Alzheimer)','Pressão Intracraniana'],
                'Ortopedia': ['Fraturas e Luxações', 'Lesões de Ligamentos', 'Lombalgia', 'Osteoartrite'],
                'Farmacologia': ['Farmacocinética', 'Farmacodinâmica', 'Antibióticos', 'Anti-hipertensivos', 'Psicofármacos'],
                'Doenças Infecto Parasitárias': ['HIV/AIDS', 'Tuberculose', 'Malária', 'Dengue, Zika e Chikungunya', 'Leishmaniose'],
                'Psiquiatria': ['Transtornos de Ansiedade', 'Transtornos Depressivos', 'Transtorno Bipolar', 'Esquizofrenia'],
                'Saúde Coletiva': ['Sistema Único de Saúde (SUS)', 'Vigilância Epidemiológica', 'Políticas de Saúde', 'Saúde da Família'],
                'Oncologia': ['Tratamento Oncológico'],
                'Dermatologia': ['Micoses','Manifestações Cutâneas das Doenças Sexualmente Transmissíveis','Leishmaniose Tegumentar Americana','Dermatozoonoses', 'Acne'],
                'Urgência e Emergência': ['Parada Cardiorrespiratória (PCR)', 'Sepse e Choque Séptico', 'Síndromes Coronarianas Agudas', 'Intoxicações Exógenas', 'Atendimento ao Politraumatizado'],
                'Urologia': ['Litíase Renal', 'Hiperplasia Prostática Benigna', 'Infecções do Trato Urinário (ITU)', 'Câncer de Próstata'],
            };
            
            // --- FUNÇÕES DE SETUP (NÃO PRECISAM DE MUDANÇA) ---
            function setupDynamicThemes(disciplinaSelectId, temasContainerId) {
                const disciplinaSelect = document.getElementById(disciplinaSelectId);
                const temasContainer = document.getElementById(temasContainerId);
                if (!disciplinaSelect) return;

                disciplinaSelect.addEventListener('change', () => {
                    const selectedOptions = Array.from(disciplinaSelect.selectedOptions).map(opt => opt.value);
                    temasContainer.innerHTML = ''; 

                    if (selectedOptions.length > 0) {
                        const label = document.createElement('label');
                        label.className = 'block text-sm font-medium text-gray-700 mb-2';
                        label.textContent = '2. Selecione o(s) Tema(s) para cada Disciplina:';
                        temasContainer.appendChild(label);
                    }

                    selectedOptions.forEach(disciplinaNome => {
                        const temas = temasPorDisciplina[disciplinaNome] || [];
                        const wrapper = document.createElement('div');
                        wrapper.className = 'p-3 border rounded-md bg-gray-50';
                        const disciplinaLabel = document.createElement('h4');
                        disciplinaLabel.className = 'font-semibold text-gray-800 mb-2';
                        disciplinaLabel.textContent = disciplinaNome;
                        const temaSelect = document.createElement('select');
                        temaSelect.multiple = true;
                        temaSelect.className = 'mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md h-24';
                        temas.forEach(tema => {
                            const option = document.createElement('option');
                            option.value = tema;
                            option.textContent = tema;
                            temaSelect.appendChild(option);
                        });
                        wrapper.appendChild(disciplinaLabel);
                        wrapper.appendChild(temaSelect);
                        temasContainer.appendChild(wrapper);
                    });
                });
            }

            // --- VERSÃO CORRIGIDA E FINAL DAS FUNÇÕES DO CADERNO ---

            let lastActiveFormsPageId = 'exercicios-page';
            let questoesDoCadernoAtual = []; // Armazena as questões buscadas

            async function gerarCaderno(event) {
                const form = event.target.closest('.page-section');
                const temasContainer = form.querySelector('[id^="temas-container-"]');
                const numQuestoesInput = form.querySelector('.num-questoes-input');

                const temasSelecionados = {};
                const disciplineBlocks = temasContainer.querySelectorAll(':scope > div');
                
                disciplineBlocks.forEach(block => {
                    const disciplinaNome = block.querySelector('h4').textContent;
                    const temaSelect = block.querySelector('select');
                    const selectedTemas = Array.from(temaSelect.selectedOptions).map(opt => opt.value);
                    if (selectedTemas.length > 0) {
                        temasSelecionados[disciplinaNome] = selectedTemas;
                    }
                });

                if (Object.keys(temasSelecionados).length === 0) {
                    alert("Por favor, selecione pelo menos um tema.");
                    return;
                }

                const corpoRequisicao = {
                    temasSelecionados: temasSelecionados,
                    limite: numQuestoesInput.value
                };

                try {
                    const response = await fetch('/api/questoes', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(corpoRequisicao),
                    });

                    if (!response.ok) {
                        const erro = await response.json();
                        throw new Error(erro.erro || 'Falha ao buscar questões.');
                    }

                    questoesDoCadernoAtual = await response.json();

                    if (questoesDoCadernoAtual.length === 0) {
                        alert("Nenhuma questão encontrada para os critérios selecionados. Verifique se os temas no banco de dados correspondem exatamente aos do site.");
                        return;
                    }
                    
                    renderCaderno(questoesDoCadernoAtual);
                    lastActiveFormsPageId = document.querySelector('.main-page:not(.hidden)').id;
                    document.getElementById(lastActiveFormsPageId).classList.add('hidden');
                    document.getElementById('caderno-page').classList.remove('hidden');

                } catch (error) {
                    console.error('Erro ao gerar caderno:', error);
                    alert(`Não foi possível gerar o caderno: ${error.message}`);
                }
            }

            function renderCaderno(questoes) {
                const container = document.getElementById('questoes-container');
                container.innerHTML = '';
                questoes.forEach((q, index) => {
                    console.log(q);
                    const questaoEl = document.createElement('div');
                    questaoEl.id = `q-${q.id}`;
                    questaoEl.className = 'border-b pb-8';
                    
                    let alternativasObj;
                    if (typeof q.alternativas === 'string') {
                        try {
                            alternativasObj = JSON.parse(q.alternativas);
                        } catch (e) {
                            console.error("Erro ao parsear JSON das alternativas:", q.alternativas, e);
                            alternativasObj = {};
                        }
                    } else {
                        alternativasObj = q.alternativas;
                    }

                    let alternativasHtml = '';
                    if (alternativasObj && typeof alternativasObj === 'object') {
                        for (const [letra, texto] of Object.entries(alternativasObj)) {
                            alternativasHtml += `
                                <label class="flex items-center p-3 rounded-md border border-gray-200 cursor-pointer hover:bg-gray-50 transition-colors">
                                    <input type="radio" name="q-${q.id}" value="${letra}" class="h-4 w-4 text-blue-600 border-gray-300 focus:ring-blue-500">
                                    <span class="ml-3 text-gray-700"><strong class="mr-2">${letra})</strong> ${texto}</span>
                                </label>
                            `;
                        }
                    } else {
                         alternativasHtml = '<p class="text-red-500">Erro: Formato de alternativas inválido.</p>';
                    }
                    let imagemHtml = '';
                    if (q.imagem_url) {
                    imagemHtml = `<div class="my-4"><img src="/static/${q.imagem_url}" alt="Imagem da questão" class="max-w-md mx-auto rounded-lg shadow-md"></div>`;
                    }
                    questaoEl.innerHTML = `
                        <p class="mb-4 text-gray-800"><strong class="mr-2">Questão ${index + 1}:</strong> ${q.enunciado}</p>
                        ${imagemHtml}  <div class="space-y-3 mb-4">${alternativasHtml}</div>
                        <button class="confirmar-resposta-btn px-4 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300">Confirmar Resposta</button>
                        <div class="resultado-container mt-4 hidden"></div>
                    `;
                    container.appendChild(questaoEl);
                });
                
                addConfirmarListeners();
            }

            function addConfirmarListeners() {
                document.querySelectorAll('.confirmar-resposta-btn').forEach(button => {
                    button.addEventListener('click', (e) => {
                        const questaoEl = e.target.closest('.border-b');
                        
                        // --- LINHA CORRIGIDA ---
                        // Remove apenas o prefixo "q-" para obter o ID completo.
                        const questaoId = questaoEl.id.substring(2); 
                        
                        const questaoData = questoesDoCadernoAtual.find(q => q.id.toString() === questaoId);
                        const selectedRadio = questaoEl.querySelector(`input[name="q-${questaoId}"]:checked`);
                        
                        if (!selectedRadio) {
                            alert('Por favor, selecione uma alternativa.');
                            return;
                        }
                        if (!questaoData) {
                            alert('Erro: não foi possível encontrar os dados da questão.');
                            return;
                        }

                        const respostaUsuario = selectedRadio.value;
                        const resultadoContainer = questaoEl.querySelector('.resultado-container');
                        
                        let resultadoHtml;
                        if (respostaUsuario.toUpperCase() === questaoData.respostaCorreta.toUpperCase()) {
                            resultadoHtml = `<div class="p-4 rounded-md bg-green-50 border border-green-200">
                                <p class="font-bold text-green-800">Resposta Correta!</p>`;
                        } else {
                            resultadoHtml = `<div class="p-4 rounded-md bg-red-50 border border-red-200">
                                <p class="font-bold text-red-800">Resposta Incorreta.</p>
                                <p class="text-sm text-red-700 mt-1">A resposta correta é a alternativa <strong class="uppercase">${questaoData.respostaCorreta}</strong>.</p>`;
                        }
                        resultadoHtml += `<p class="mt-2 text-sm text-gray-600"><strong>Comentário:</strong> ${questaoData.comentario}</p></div>`;
                        
                        resultadoContainer.innerHTML = resultadoHtml;
                        resultadoContainer.classList.remove('hidden');
                        e.target.disabled = true; 
                        questaoEl.querySelectorAll('input[type="radio"]').forEach(radio => radio.disabled = true);
                    });
                });
            }

            // --- LÓGICA DE NAVEGAÇÃO E COMPONENTES ---
            document.getElementById('voltar-btn').addEventListener('click', () => {
                document.getElementById('caderno-page').classList.add('hidden');
                document.getElementById(lastActiveFormsPageId).classList.remove('hidden');
            });
            document.querySelectorAll('.criar-caderno-btn').forEach(btn => btn.addEventListener('click', gerarCaderno));
            // ... (o resto das funções de navegação que não foram alteradas)

            const mainNavLinks = document.querySelectorAll('.nav-link, .nav-link-mobile');
            const subNavLinks = document.querySelectorAll('.sub-nav-link');
            const mainPages = document.querySelectorAll('.main-page');
            let activeMainPageId = 'exercicios-page';
            let activeCiclo = 'basico';

            function updateView() {
                mainPages.forEach(page => page.classList.toggle('hidden', page.id !== activeMainPageId));
                const activePage = document.getElementById(activeMainPageId);
                if (activePage) {
                    const cycleSections = activePage.querySelectorAll('.page-section');
                     cycleSections.forEach(section => {
                        section.classList.toggle('hidden', !section.id.startsWith(activeCiclo));
                    });
                }
                mainNavLinks.forEach(link => {
                    const linkTarget = link.getAttribute('href').substring(1); 
                    link.classList.toggle('bg-blue-600', linkTarget === activeCiclo);
                    link.classList.toggle('text-white', linkTarget === activeCiclo);
                    link.classList.toggle('text-gray-500', linkTarget !== activeCiclo);
                });
                subNavLinks.forEach(link => {
                    const linkTargetId = link.getAttribute('href').substring(1);
                    link.classList.toggle('sub-nav-link-active', linkTargetId === activeMainPageId);
                });
            }
            mainNavLinks.forEach(link => {
                link.addEventListener('click', e => { e.preventDefault(); activeCiclo = link.getAttribute('href').substring(1); updateView(); });
            });
            subNavLinks.forEach(link => {
                link.addEventListener('click', e => { e.preventDefault(); activeMainPageId = link.getAttribute('href').substring(1); updateView(); });
            });

            const mobileMenuButton = document.getElementById('mobile-menu-button');
            const mobileMenu = document.getElementById('mobile-menu');
            if(mobileMenuButton) mobileMenuButton.addEventListener('click', () => {
                mobileMenu.classList.toggle('hidden');
                mobileMenuButton.querySelectorAll('svg').forEach(icon => icon.classList.toggle('hidden'));
            });

            // --- INICIALIZAÇÃO ---
            setupDynamicThemes('disciplinas-basico-exercicios', 'temas-container-basico-exercicios');
            setupDynamicThemes('disciplinas-clinico-exercicios', 'temas-container-clinico-exercicios');
            setupDynamicThemes('disciplinas-basico-simulados', 'temas-container-basico-simulados');
            setupDynamicThemes('disciplinas-clinico-simulados', 'temas-container-clinico-simulados');
            updateView();
        });
   
    </script>

</body>
</html>
